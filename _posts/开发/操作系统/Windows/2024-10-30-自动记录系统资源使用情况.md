---
tags:
    - 操作系统
    - Windows
---

https://help.tableau.com/current/server/en-us/perf_collect_perfmon.htm



## 使用 Windows 性能监视器收集数据

若要监视资源使用量和服务器进程，您可以使用 Windows 服务器附带的 Windows 性能监视器 (PerfMon)。使用 PerfMon 来收集详细性能信息，包括 CPU 的使用频率、使用的内存量、有关每个 Tableau Server 进程的信息，等等。

有关每个 Tableau Server 进程的作用的详细信息，请参见 [Tableau Server 进程](https://help.tableau.com/current/server/zh-cn/processes.htm)。

**免责声明**：此信息会引用第三方产品。本示例并不认可此产品优于任何其他竞争产品。

在能够使用 PerfMon 之前，您需要设置数据收集器集，这是 PerfMon 存储它所收集的数据的方式。若要使用 PerfMon 收集有关 Tableau Server 进程的信息，创建数据收集器集时，Tableau Server 必须正在运行。在 PerfMon 中收集的数据经常被称为性能计数器。

## 如何使用 Windows 性能监视器收集数据

### 步骤 1：创建新数据收集器集

1. 单击 Windows 的“开始”菜单，并搜索“性能”.
2. 右键单击**“性能监视器”**，然后单击**“以管理员身份运行”**。
3. 在左侧窗格中，单击**“数据收集器集”**。
4. 在右侧窗格中，右键单击**“用户定义”**，单击**“新建”**，然后单击**“数据收集器集”**。
5. 在**“创建新数据连接器集”**向导中，输入数据连接器集的名称。例如，您可能会输入 **Tableau Server 性能**。
6. 选择**“手动创建(高级)”**，然后单击**“下一步”**。
7. 在**“创建数据日志”**下，选择**“性能计数器”**，并单击**“下一步”**。

### 步骤 2：选择性能计数器

1. 将抽样时间间隔设置为 30 秒。

2. 单击**“添加”**。

3. 选择要为其记录性能数据的计算机。

   如果在单一计算机上运行 Tableau Server，请选择**“<本地计算机>”**。如果在多台计算机上运行 Tableau Server，您必须重复其中的某些步骤来收集有关每台计算机的数据。

4. 从列表中选择性能计数器。

   下表列出了我们建议用于跟踪 Tableau Server 性能的性能计数器。

   | 类别       | 性能计数器                                                   | 说明                                                         |
   | :--------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
   | 逻辑磁盘   | 当前磁盘队列长度磁盘每秒钟读取字节数Disk Write Bytes/sec（磁盘每秒钟写入字节数） | 未处理的写请求数以及读写到服务器硬盘上的字节数。为安装了 Tableau Server 的磁盘选择这些计数器（在 PerfMon 中简称*实例*）。 |
   | 内存       | % Committed Bytes in Use（已提交字节数使用率）Available MBytes（可用内存数） | 使用的虚拟内存百分比，以及可用内存量（以 MB 为单位）。       |
   | 处理器信息 | %Processor Time（处理器时间 %）% Processor Utility（处理器使用率 %） | 处理器在活动状态下所花费时间的百分比，以及处理器所使用的处理能力的百分比。 |
   | 进程       | 处理器时间 %专用字节数                                       | 特定进程所使用的处理能力的百分比，以及为该进程保留的内存量。为以下进程选择这些计数器（在 PerfMon 中称为*实例*）。`run-backgrounder`（后台程序）`run-dataserver`（数据服务器）`redis-server`（缓存服务器）`hyperd`（数据引擎）`run-vizqlserver` (VizQL Server) |

   若要选择每个性能计数器，请执行以下操作：

   1. 双击以在下拉列表中选择一个类别。

   2. 选择要使用的一个或多个性能计数器。

   3. 在**所选对象的实例**下，如果合适，选择要收集其相关信息的进程（或实例）。

      ![img](/img-post/开发/操作系统/Windows/自动记录系统资源使用情况.assets/everybody_perfmon_add_counters.png)

   4. 单击**“添加”**。

   5. 如果在多台计算机上运行 Tableau Server，请返回到步骤 3，选择另一台计算机，然后重复上面的步骤。

      **重要信息：**根据您配置服务器进程跨计算机运行的方式，您可能只必须监视为每台计算机列出的进程的子集。例如，最好在单独的计算机上隔离后台程序进程。因此，对于该计算机，您将只监视后台程序进程。

   6. 单击**“确定”**，然后单击**“下一步”**。

### 步骤 3：保存数据收集器集

1. 浏览到您要在其中存储数据的目录，然后单击**“下一步”**。

   **重要信息：**您必须将数据存储在 Tableau 可访问的位置。例如，您可能希望将数据存储在网络驱动器上。如果未映射网络驱动器，请右键单击**“此电脑”**并选择**“添加网络位置”**。

2. 单击**“完成”**。

3. 在主**“性能监视器”**窗口的左侧窗格中，选择要创建的数据收集器集。

4. 在右侧窗格中，右键单击性能计数器**“DataCollector01”**，然后单击**“属性”**。

5. 选择**“用逗号分隔”**作为日志格式，然后单击**“确定”**。

### 步骤 4：运行数据收集器集

在左侧窗格中，右键单击您创建的数据收集器集的名称，然后单击**“开始”**。Windows 性能监视器工具会开始监视您的服务器并在您指定的位置存储信息