---
tags:
    - NAS
---

## **问题现象：**

当群晖NAS绑定域名暴露在公网时，可能会遭遇网络攻击而出现流量异常的情况。具体表现为：关闭群晖自带的BT下载，网络同步等功能后，在资源监控中仍能看到有几十KB/s的上传/下载流量。

## 问题判断：

群晖系统自身不能看到每个进程的网络使用情况，所以需要借助第三方工具实现：

- 在群晖系统自带的Docker中安装指令，如janten/iftop, jackus/nethogs
- telnet/SSH进群晖并启用管理员权限

```text
sudo -i
```

- 在telnet/SSH连接中使用指令工具查询进程的网络使用情况：

```text
docker run -it --rm --net host janten/iftop -P -i eth0
或
docker run -it --rm --net host jackus/nethogs
```

- 根据对应端口查询进程

```text
netstat -pantu | grep [port]
```

## 解决方法：

通过上一个步骤，我们可以查到占用网络资源的端口以及进程，再通过群晖系统-资源监控-任务管理器，查到对应进程的服务，关闭该服务即可。

但还有一种情况，即使关闭该端口的所有进程，该端口占用网络资源的情况仍然存在，如端口1723。

这时候需要使用群晖系统自带防火墙来阻断站外的异常流量：

> 群晖系统-控制面板-防火墙-防火墙配置文件-编辑规则-新增
> 端口：1723
> 通讯协议：所有
> 来源IP：所有
> 操作：拒绝

以上操作能杜绝所有的上传流量，但下载流量仍然存在。这时候也可以根据对方的发包端口，如80/443新增防火墙规则，但往往是无效的。

但是没关系，底下要做的就是等待几天，对方发现目标地址只有发出去的包，没有返回包，自然也就停止攻击了。





https://zhuanlan.zhihu.com/p/351428052